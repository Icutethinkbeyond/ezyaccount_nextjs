generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  userId       String     @id @default(auto()) @map("_id") @db.ObjectId
  username     String?
  userEmail    String     @unique
  userPassword String
  userStatus   UserStatus @default(Active)
  name         String?
  phone        String?

  // Relations
  account        Account?
  role           Role?           @relation(fields: [roleId], references: [roleId])
  roleId         String?         @db.ObjectId
  profile        Profile?
  address        Address?
  companyProfile CompanyProfile?
  customerId     String?    
  resetTokens    ResetToken[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userEmail, username])
}

model Profile {
  profileId      String  @id @default(auto()) @map("_id") @db.ObjectId
  profileName    String?
  profileSurname String?
  profileimage   String?
  profilePhone   String?

  // Relations
  user   User?   @relation(fields: [userId], references: [userId])
  userId String? @unique @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CompanyProfile {
  companyId               String    @id @default(auto()) @map("_id") @db.ObjectId
  companyName             String // ชื่อบริษัท
  companyAddress          Address[] // ที่อยู่บริษัท
  companyTaxId            String? // เลขประจำตัวผู้เสียภาษี
  companyPhoneNumber      String? // เบอร์โทรศัพท์
  companyEmail            String? // อีเมล
  companyWebsite          String? // เว็บไซต์
  companyRegistrationDate DateTime // วันที่จดทะเบียน
  companyBusinessType     String? // ประเภทธุรกิจ

  bankAccounts BankAccount[] // ความสัมพันธ์กับบัญชีธนาคารของบริษัท
  user         User          @relation(fields: [userId], references: [userId])
  userId       String        @unique @db.ObjectId
  customers    Customer[]

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // วันที่อัปเดตล่าสุด
}

model Customer {
  customerId    String  @id @default(auto()) @map("_id") @db.ObjectId
  customerEmail String  @unique
  customerTaxId String? @unique

  address        Address[]
  companyProfile CompanyProfile? @relation(fields: [companyId], references: [companyId])
  companyId      String?         @db.ObjectId

  documentPaper DocumentPaper[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  provider          String // เช่น google, facebook
  providerAccountId String? // ID จาก provider
  accessToken       String?
  refreshToken      String?
  expiresAt         Int?

  user     User           @relation(fields: [userId], references: [userId])
  userId   String         @unique @db.ObjectId
  verified VerifiedStatus @default(UnVerified)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerAccountId])
}

model ResetToken {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  token   String   @unique
  expires DateTime

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [userId])

  createdAt DateTime @default(now())
}

model Role {
  roleId      String   @id @default(auto()) @map("_id") @db.ObjectId
  name        RoleName
  description String?

  users       User[]
  userIds     String[] @db.ObjectId
  customerIds String[] @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name])
}

model Address {
  addressId   String  @id @default(auto()) @map("_id") @db.ObjectId
  address1    String
  address2    String?
  subDistrict String
  city        String
  state       String
  postalCode  String
  country     String

  user           User            @relation(fields: [userId], references: [userId])
  userId         String          @unique @db.ObjectId
  customer       Customer?       @relation(fields: [customerId], references: [customerId])
  customerId     String?         @db.ObjectId
  CompanyProfile CompanyProfile? @relation(fields: [companyId], references: [companyId])
  companyId      String?         @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BankAccount {
  bankAccountId     String  @id @default(auto()) @map("_id") @db.ObjectId
  bankAccountNo     String
  bankAccountName   String
  bankAccountBranch String?

  CompanyProfile          CompanyProfile? @relation(fields: [companyProfileCompanyId], references: [companyId])
  companyProfileCompanyId String?         @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  categoryId   String    @id @default(auto()) @map("_id") @db.ObjectId
  categoryName String
  categoryDesc String?
  products     Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  productId String @id @default(auto()) @map("_id") @db.ObjectId

  productName        String // ชื่อสินค้า
  productSKU         String? // รหัสสินค้า
  productDescription String? // คำอธิบายสินค้า
  productImage       String?

  aboutProduct AboutProduct?

  documentProduct    DocumentProduct[] @relation(fields: [documentProductIds], references: [documentProductId])
  documentProductIds String[]          @db.ObjectId

  category   Category? @relation(fields: [categoryId], references: [categoryId])
  categoryId String?   @db.ObjectId

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // อัปเดตล่าสุด
}

model AboutProduct {
  aboutProductId String @id @default(auto()) @map("_id") @db.ObjectId

  product   Product @relation(fields: [productId], references: [productId], onDelete: Cascade)
  productId String  @unique @db.ObjectId

  //Price
  productPrice         Float?  @default(0)
  productDiscountPrice Float?  @default(0)
  productStock         Int?    @default(0)
  productBrand         String? // ยี่ห้อ/แบรนด์ (อาจเป็น null ได้)

  unitName String?

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // อัปเดตล่าสุด
}

model DocumentPaper {
  documentId      String  @id @default(auto()) @map("_id") @db.ObjectId
  documentIdNo    String  @unique
  documentDetials String?

  customer   Customer? @relation(fields: [customerId], references: [customerId])
  customerId String?   @db.ObjectId

  documentType   DocumentType   @default(Quotation)
  documentStatus DocumentStatus @default(Draft)

  documentCreateDate DateTime?
  documentExpire     DateTime?

  priceTotal    Float @default(0)
  discountTotal Float @default(0)

  includeVat Boolean @default(false)
  vatPrice   Float   @default(0)

  withHolding        Boolean @default(false)
  withHoldingPercent Float   @default(0)
  withHoldingPrice   Float   @default(0)

  files                DocumentFile[]
  documentProductGroup DocumentProductGroup[]
  documentProduct      DocumentProduct[]

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // อัปเดตล่าสุด
}

model DocumentProductGroup {
  documentProductGroupId String @id @default(auto()) @map("_id") @db.ObjectId

  documentProductGroupName String
  documentProductGroupDesc String?

  documentPaper   DocumentPaper @relation(fields: [documentPaperId], references: [documentId])
  documentPaperId String        @db.ObjectId

  documentProduct DocumentProduct[]

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // อัปเดตล่าสุด
}

model DocumentProduct {
  documentProductId String @id @default(auto()) @map("_id") @db.ObjectId

  products   Product[] @relation(fields: [productIds], references: [productId])
  productIds String[]  @db.ObjectId

  quantity Int @default(1)

  price         Float @default(0)
  discountPrice Float @default(0)

  documentPaper   DocumentPaper @relation(fields: [documentPaperId], references: [documentId])
  documentPaperId String        @db.ObjectId

  documentProductGroup   DocumentProductGroup @relation(fields: [documentProductGroupId], references: [documentProductGroupId])
  documentProductGroupId String               @db.ObjectId

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // อัปเดตล่าสุด
}

model DocumentFile {
  fileId   String @id @default(auto()) @map("_id") @db.ObjectId
  filePath String
  fileName String

  fileType String?

  documentPaper   DocumentPaper @relation(fields: [documentPaperId], references: [documentId])
  documentPaperId String        @unique @db.ObjectId

  createdAt DateTime @default(now()) // วันที่สร้าง
  updatedAt DateTime @updatedAt // อัปเดตล่าสุด
}

enum DocumentType {
  Quotation
}

enum DocumentStatus {
  Draft
  Waiting
  Approve
  Cancel
}

enum VerifiedStatus {
  Verified
  UnVerified
}

enum UserStatus {
  Active
  InActice
}

enum RoleName {
  Developer
  Administrator
  User
  Customer
}

enum ProviderAccount {
  Google
  Facebook
  Email
}
