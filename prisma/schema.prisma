generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  userId       String     @id @default(auto()) @map("_id") @db.ObjectId
  username     String?
  userEmail    String
  userPassword String
  userStatus   UserStatus @default(Active)

  // Relations
  account        Account?
  role           Role?           @relation(fields: [roleId], references: [roleId])
  roleId         String?         @db.ObjectId
  profile        Profile?
  address        Address?
  companyProfile CompanyProfile?
  resetTokens    ResetToken[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userEmail, username])
}

model Profile {
  profileId      String  @id @default(auto()) @map("_id") @db.ObjectId
  profileName    String?
  profileSurname String?
  profileimage   String?
  profilePhone   String?

  // Relations
  user       User?     @relation(fields: [userId], references: [userId])
  userId     String?   @unique @db.ObjectId
  customer   Customer? @relation(fields: [customerId], references: [customerId])
  customerId String?   @unique @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CompanyProfile {
  companyId               String   @id @default(auto()) @map("_id") @db.ObjectId
  companyName             String // ชื่อบริษัท
  companyAddress          Address? // ที่อยู่บริษัท
  companyTaxId            String? // เลขประจำตัวผู้เสียภาษี
  companyPhoneNumber      String? // เบอร์โทรศัพท์
  companyEmail            String? // อีเมล
  companyWebsite          String? // เว็บไซต์
  companyRegistrationDate DateTime // วันที่จดทะเบียน
  companyBusinessType     String? // ประเภทธุรกิจ

  bankAccounts BankAccount[] // ความสัมพันธ์กับบัญชีธนาคารของบริษัท
  user         User          @relation(fields: [userId], references: [userId])
  userId       String        @unique @db.ObjectId
  customers    Customer[]

  createdAt        DateTime @default(now()) // วันที่สร้าง
  updatedAt        DateTime @updatedAt // วันที่อัปเดตล่าสุด
}

model Customer {
  customerId    String  @id @default(auto()) @map("_id") @db.ObjectId
  customerEmail String  @unique
  customerTaxId String? @unique

  // Relations
  role           Role            @relation(fields: [roleId], references: [roleId])
  roleId         String          @db.ObjectId
  profile        Profile?
  address        Address?
  companyProfile CompanyProfile? @relation(fields: [companyId], references: [companyId])
  companyId      String?         @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  provider          String // เช่น google, facebook
  providerAccountId String? // ID จาก provider
  accessToken       String?
  refreshToken      String?
  expiresAt         Int?

  user     User           @relation(fields: [userId], references: [userId])
  userId   String         @unique @db.ObjectId
  verified VerifiedStatus @default(UnVerified)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerAccountId])
}

model ResetToken {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  token   String   @unique
  expires DateTime

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [userId])

  createdAt DateTime @default(now())
}

model Role {
  roleId      String   @id @default(auto()) @map("_id") @db.ObjectId
  name        RoleName
  description String?

  users       User[]
  userIds     String[]   @db.ObjectId
  Customer    Customer[]
  customerIds String[]   @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name])
}

model Address {
  addressId   String  @id @default(auto()) @map("_id") @db.ObjectId
  address1    String
  address2    String?
  subDistrict String
  city        String
  state       String
  postalCode  String
  country     String

  user           User            @relation(fields: [userId], references: [userId])
  userId         String          @unique @db.ObjectId
  customer       Customer?       @relation(fields: [customerId], references: [customerId])
  customerId     String?         @unique @db.ObjectId
  CompanyProfile CompanyProfile? @relation(fields: [companyId], references: [companyId])
  companyId      String?         @unique @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BankAccount {
  bankAccountId     String  @id @default(auto()) @map("_id") @db.ObjectId
  bankAccountNo     String
  bankAccountName   String
  bankAccountBranch String?

  CompanyProfile          CompanyProfile? @relation(fields: [companyProfileCompanyId], references: [companyId])
  companyProfileCompanyId String?         @db.ObjectId

  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt

}

// model tbl_archive {
//   archive_id            String  @id @default(auto()) @map("_id") @db.ObjectId
//   upload_by             Int
//   file_name             String
//   account_name          String
//   business_id           Int
//   createDate            DateTime @default(now())
//   isDeleted             IsDeleted @default(NO)
// }

// model tbl_bank {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   bank_name             String
//   bank_image            String
// }

// model tbl_business {
//   business_id             String  @id @default(auto()) @map("_id") @db.ObjectId
//   business_name           String
//   main_branch             Int  //Old dataType "tinyint"
//   branch                  String
//   main_office             Int
//   tax_id                  Int
//   business_mobile         String
//   business_email          String
//   business_facebook       String
//   business_line           String
//   business_image          String
//   business_address        String
//   business_employee_count Int
//   isPerson                is_Person //Old dataType "enum('yes','no','legal','person')"
//   isVat                   is_Vat //Old dataType "enum('yes','no')"
//   isDeleted               IsDeleted @default(NO)
//   package_id              Int
//   package_start_date      DateTime @default(now())
//   package_end_date        DateTime @default(now())
//   userId                  Int
// }

// model tbl_category {
//   cat_id                  String  @id @default(auto()) @map("_id") @db.ObjectId
//   cat_parent_id           Int
//   cat_name                String
//   cat_description         String
//   cat_image               String
//   business_id             Int
// }

// model tbl_commission {
//   commission_id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   createDate              DateTime @default(now())
//   user_id                 Int  
//   sales                   Float //Old dataType "float"
//   commission              Float //Old dataType "float"
//   commission_rate         Int
// }

// model tbl_commissionrate {
//   commissionrate_id       String  @id @default(auto()) @map("_id") @db.ObjectId
//   business_id             Int
//   role_id                 Int
//   minimumrate             Int
//   percent                 Int
// }

// model tbl_config_free {
//   business_id             String  @id @default(auto()) @map("_id") @db.ObjectId
//   status                  Boolean //Old dataType "int"
// }

// model tbl_config_free_detail {
//   id                      String  @id @default(auto()) @map("_id") @db.ObjectId
//   business_id             Int
//   minimum_rate            Int
//   free_id                 Int
// }

// model tbl_config_gift {
//   id                      String  @id @default(auto()) @map("_id") @db.ObjectId
//   business_id             Int
//   minimum_rate            Int
//   point                   Int
// }

// model tbl_config_payment {
//   id                      String  @id @default(auto()) @map("_id") @db.ObjectId
//   payment_id              Int
//   business_id             Int
//   paypal_email            String
//   omise_pkey              String
//   omise_skey              String
//   promptpay_id            String
//   status                  Boolean  @default(true)
// }

// model tbl_config_vat {
//   business_id             String  @id @default(auto()) @map("_id") @db.ObjectId
//   status                  Boolean //Old dataType "int"
//   price_include_vat       Int
//   tax_id                  String
//   running_no_type         String
// }

// model tbl_credit {
//   credit_id               String  @id @default(auto()) @map("_id") @db.ObjectId
//   od_id                   Int
//   od_bill                 Int
//   od_shipping_name        String
//   od_shipping_email       String
//   od_shipping_phone       String
//   od_shipping_address     String
//   od_createDate           DateTime @default(now())
//   od_createBy             Int
//   od_status               Boolean //Old dataType "enum('ยังไม่ได้ชำระเงิน','ชำระเงินแล้ว','รอการตรวจสอบ','เตรียมการจัดส่ง','จัดส่งเรียบร้อยแล้ว','ยกเลิกคำสั่งซื้อ')"
//   od_updateDate           DateTime @default(now())
//   cus_id                  Int
//   business_id             Int
//   vat_status              Boolean @default(true)
//   tax_withheld            Int
//   credit_note_No          String
//   tax_invoice_No          String
//   isDeleted               IsDeleted @default(NO)
//   note                    String
//   file_import             String
//   credit_status           CDP_status @default(WAIT_APPROVE) //Old dataType "enum('approve','wait_approve','cancel','draft','create_tax_invoice')"
//   billing_cause           String
//   billing_specify         String
// }

// model tbl_credit_item {
//   credit_item_id          String  @id @default(auto()) @map("_id") @db.ObjectId
//   od_id                   Int
//   pd_id                   Int
//   od_qty                  Int
//   od_price                Int
// }

// model tbl_customers {
//   userId                String  @id @default(auto()) @map("_id") @db.ObjectId
//   email                 String
//   username              String
//   password              String
//   facebook_id           String
//   google_id             String
//   userline_id           String
//   name                  String
//   mobile                String
//   address               String //Old dataType "text"
//   tax_id                String
//   roleId                Int    //Old dataType "tinyint"
//   userImage             String
//   isDeleted             IsDeleted @default(NO)
//   createdBy             Int
//   createdDtm            DateTime @default(now())
//   updatedBy             Int
//   updatedDtm            DateTime @default(now())
//   business_id           Int
//   hash                  String
//   verified              Int //Old dataType "tinyint"
//   point                 Int 
// }

// model tbl_debit {
//   debit_id              String  @id @default(auto()) @map("_id") @db.ObjectId
//   od_id                 Int
//   od_bill               Int
//   od_shipping_name      String
//   od_shipping_email     String
//   od_shipping_phone     String
//   od_shipping_address   String
//   od_createDate         DateTime @default(now())
//   od_createBy           Int
//   od_status             Boolean //Old dataType "enum('ยังไม่ได้ชำระเงิน','ชำระเงินแล้ว','รอการตรวจสอบ','เตรียมการจัดส่ง','จัดส่งเรียบร้อยแล้ว','ยกเลิกคำสั่งซื้อ')"
//   od_updateDate         DateTime @default(now())
//   cus_id                Int
//   business_id           Int
//   vat_status            Boolean @default(true)
//   tax_withheld          Int
//   debit_note_No         String
//   tax_invoice_No        String
//   isDeleted             IsDeleted @default(NO)
//   debit_status          CDP_status @default(WAIT_APPROVE) //Old dataType "enum('approve','wait_approve','cancel','draft','create_tax_invoice')"
//   note                  String
//   file_import           String
// }

// model tbl_debit_item {
//   debit_item_id         String  @id @default(auto()) @map("_id") @db.ObjectId
//   od_id                 Int
//   pd_id                 Int
//   od_qty                Int
//   od_price              Int
// }

// model tbl_duedate {
//   duedate_id            String  @id @default(auto()) @map("_id") @db.ObjectId
//   business_id           Int
//   duedate               DateTime @default(now())
//   doing_status          Int //Old dataType "tinyint"
// }

// model tbl_exchange_reward {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   createdDate           DateTime @default(now())
//   cus_id                Int
//   gift_id               Int
//   business_id           Int
// }

// model tbl_expenses {
//   expenses_id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   expenses_No           String
//   expenses_date         DateTime @default(now())
//   supplier              String
//   address               String
//   tax_no                Int
//   branch                Int
//   bill                  String
//   vat_status            Boolean @default(true)
//   tax_withheld          Int
//   expenses_status       Doc_Status @default(WAIT_APPROVE) //Old dataType "enum('approve','cancel','draft','wait_approve')"
//   note                  String
//   business_id           Int
// }

// model tbl_expenses_item {
//   expenses_item_id      String  @id @default(auto()) @map("_id") @db.ObjectId
//   expenses_id           Int
//   description           String
//   price                 Int
// }

// model tbl_free {
//   free_id               String  @id @default(auto()) @map("_id") @db.ObjectId
//   free_name             String
//   free_image            String
//   business_id           Int
//   status                Boolean  @default(true)
// }

// model tbl_gift {
//   gift_id               String  @id @default(auto()) @map("_id") @db.ObjectId
//   gift_name             String
//   gift_point            Int
//   gift_image            String
//   start_date            DateTime @default(now())
//   end_date              DateTime @default(now())
//   business_id           Int
//   status                Boolean  @default(true)
// }

// model tbl_last_login {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   userId                Int //Old dataType "bigint"
//   sessionData           String
//   machineIp             String
//   userAgent             String
//   agentString           String
//   platform              String
//   createdDtm            DateTime @default(now())
// }

// model tbl_mainproduct {
//   mp_id                 String  @id @default(auto()) @map("_id") @db.ObjectId
//   mp_name               String
//   od_id                 Int
// }

// model tbl_order {
//   od_id                 String  @id @default(auto()) @map("_id") @db.ObjectId
//   od_shipping_name      String
//   od_shipping_email     String
//   od_shipping_phone     String
//   od_shipping_address   String
//   od_shipping_cost      Float   //Old dataType "float"
//   shipping_id           Int
//   companyName           String
//   companyPhone          String
//   companyAdds           String
//   companyTax            String
//   branch                String
//   od_createDate         DateTime @default(now())
//   od_createBy           Int
//   cus_id                Int
//   od_updateDate         DateTime @default(now())
//   od_status             String //Old dataType "enum('ยังไม่ได้ชำระเงิน','ชำระเงินแล้ว','รอการตรวจสอบ','เตรียมการจัดส่ง','จัดส่งเรียบร้อยแล้ว','ยกเลิกคำสั่งซื้อ')"
//   od_payment_type       String
//   od_payment            String
//   od_bill               String
//   od_shipping_code      String
//   business_id           Int
//   free_id               Int
//   vat_status            Boolean  @default(true)
//   price_include_vat     Boolean @default(true)
//   tax_withheld          Int
//   invoice_No            String
//   tax_invoice_No        String
//   billing_No            String
//   isDeleted             IsDeleted @default(NO)
//   note_invoice          String
//   note_tax_invoice      String
//   note_billing          String
//   file_import_invoice   String
//   file_import_tax_invoice   String
//   file_import_billing   String
//   invoice_status        IV_status //Old dataType "enum('approve','wait_approve','cancel','draft','wait_accept','billng_done','create_credit','create_debit')"
//   tax_invoice_status    TI_status //Old dataType "enum('approve','wait_approve','cancel','draft','wait_accept')"
//   billing_status        Doc_Status @default(WAIT_APPROVE) //Old dataType "enum('approve','wait_approve','cancel','draft')"
// }

// enum TI_status {
//   APPROVE
//   CANCEL
//   WAIT_APPROVE
//   DRAFT
//   WAIT_ACCEPT
// }

// enum IV_status {
//   APPROVE
//   CANCEL
//   WAIT_APPROVE
//   DRAFT
//   WAIT_ACCEPT
//   BILLING_DONE
//   CREATE_CREDIT
//   CREATE_DEBIT
// }

// model tbl_order_item {
//   od_id                 String  @id @default(auto()) @map("_id") @db.ObjectId
//   pd_id                 Int
//   od_qty                Int
//   od_price              Float //Old dataType "float"
//   pre_order_id          Int
// }

// model tbl_package {
//   package_id            String  @id @default(auto()) @map("_id") @db.ObjectId
//   package_name          String
//   package_price         Int
//   annual_price          Int
//   package_desc          String
// }

// model tbl_payment_type {
//   payment_id            String  @id @default(auto()) @map("_id") @db.ObjectId
//   payment_type          String
// }

// model tbl_point_collection {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   createdDate           DateTime @default(now())
//   od_id                 Int
//   cus_id                Int
//   total_price           Float // Old dataType "float"
//   point                 Int
//   business_id           Int
// }

// model tbl_product {
//   pd_id                 String  @id @default(auto()) @map("_id") @db.ObjectId
//   barcode               String
//   barcode_img           String
//   cat_id                Int
//   mp_id                 Int
//   pd_name               String
//   pd_description        String  //Old dataType "text"
//   pd_qty                Int //Old dataType "smallint"
//   pd_price              Float //Old dataType "float"
//   service_cost          Float //Old dataType "float"
//   general_expenses      Float //Old dataType "float"
//   pd_discount           Float //Old dataType "float"
//   pd_image              String
//   pd_date               DateTime @default(now())
//   pd_last_update        DateTime @default(now())
//   pd_status             String //Old dataType "enum('use','cancel')"
//   business_id           Int
//   point                 Int
//   free_id               Int
//   minimum_quantity_free   Int
// }

// model tbl_purchase {
//   purchase_id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   supplier_name         String
//   supplier_office       String
//   supplier_phone        Int
//   supplier_address      String
//   supplier_taxId        String
//   branch                String
//   createDate            DateTime @default(now())
//   createBy              Int
//   purchaseDate          DateTime @default(now())
//   vat_status            Int
//   tax_withheld          String
//   price_include_vat     Boolean @default(true)
//   purchase_No           String
//   note                  String
//   file_import           String
//   purchase_status       CDP_status  @default(WAIT_APPROVE) //Old dataType "enum('approve','wait_approve','cancel','draft','create_tax_invoice')"
//   business_id           Int
//   isDeleted             IsDeleted @default(NO)
// }

// model tbl_purchase_item {
//   purchase_item_id      String  @id @default(auto()) @map("_id") @db.ObjectId
//   purchase_id           Int
//   pd_name               String
//   pd_id                 Int
//   pd_qty                Int
//   pd_price              Int
//   pd_discount           Int
// }

// model tbl_receipt {
//   receipt_id            String  @id @default(auto()) @map("_id") @db.ObjectId
//   purchase_id           Int
//   supplier_name         String
//   supplier_office       String
//   supplier_address      String
//   supplier_taxId        String
//   supplier_phone        Int
//   branch                String
//   createDate            DateTime @default(now())
//   createBy              Int
//   receiptDate           DateTime @default(now())
//   vat_status            Int
//   tax_withheld          String
//   receipt_No            String
//   price_include_vat     Int
//   note                  String
//   business_id           Int
//   isDeleted             IsDeleted @default(NO)
//   receipt_status        Doc_Status @default(WAIT_APPROVE) //Old dataType "enum('approve','wait_approve','cancel','draft')"
//   file_import           String
// }

// model tbl_receipt_item {
//   receipt_item_id       String  @id @default(auto()) @map("_id") @db.ObjectId
//   receipt_id            Int
//   od_id                 Int
//   pd_id                 Int
//   od_qty                Int
//   od_price              Int
//   pd_discount           Int
// }

// model tbl_reset_password {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   email                 String
//   activation_id         String
//   agent                 String
//   client_ip             String
//   isDeleted             IsDeleted @default(NO)
//   createdBy             Int //Old dataType "bigint"
//   createdDtm            DateTime @default(now())
//   updatedBy             Int //Old dataType "bigint"
//   updatedDtm            DateTime @default(now())
// }

// model tbl_roles {
//   roleId                String  @id @default(auto()) @map("_id") @db.ObjectId
//   role                  String
// }

// model tbl_sales_package {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   userId                Int
//   package_id            Int
//   createDate            DateTime @default(now())
//   updateDate            DateTime @default(now())
//   startDate             DateTime @default(now())
//   endDate               DateTime @default(now())
//   status                Boolean //Old dataType "int"
//   payment_type          String
//   bill                  String
//   paypal_id             Int
//   totalPrice            Int
//   seller_code           String
// }

// model tbl_sellers {
//   seller_id             String  @id @default(auto()) @map("_id") @db.ObjectId
//   seller_name           String
//   seller_code           String
// }

// model tbl_seller_sales {
//   sale_id               String  @id @default(auto()) @map("_id") @db.ObjectId
//   user_id               Int
//   business_id           Int
//   createDate            DateTime @default(now())
// }

// model tbl_seller_sales_detail {
//   sale_id               String  @id @default(auto()) @map("_id") @db.ObjectId
//   pd_id                 Int
//   pd_price              Float //Old dataType "float"
//   quantity              Int
// }

// model tbl_shipping_type {
//   shipping_type_id      String  @id @default(auto()) @map("_id") @db.ObjectId
//   shipping_type_name    String
//   shipping_type_cost    Float //Old dataType "float"
//   business_id           Int
// }

// model tbl_shopping_cart {
//   business_id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   status                Int
// }

// model tbl_stock_config {
//   business_id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   min_qty               Int
// }

// model tbl_stock_log {
//   id                    String  @id @default(auto()) @map("_id") @db.ObjectId
//   business_id           Int
//   createdDate           DateTime @default(now()) //Old dataType "DateTime @default(now())"
//   stock_type            String
//   pd_id                 Int
//   pd_qty                Int
//   pd_total              Int
// }

// model tbl_supplier {
//   supplier_id           String  @id @default(auto()) @map("_id") @db.ObjectId
//   supplier_name         String
//   supplier_office       String
//   supplier_address      String
//   supplier_taxId        String
//   business_id           Int
// }

// model tbl_supplier_item {
//   supplier_item_id      String  @id @default(auto()) @map("_id") @db.ObjectId
//   item_name             String
//   item_price            Int
//   supplier_id           Int
//   business_id           Int
// }

// model tbl_withholding {
//   withholding_id        String  @id @default(auto()) @map("_id") @db.ObjectId
//   withholding_no        String
//   cus_id                Int
//   withholding_type      String
//   date_taxdeductible    DateTime @default(now())
//   payer                 Int
//   payer_other           String
//   withholding_tax       Boolean @default(false) //Old dataType "enum('ภาษีหัก ณ ที่จ่าย','ภาษีถูกหัก ณ ที่จ่าย')"
//   amount_paid           Int
//   wh_tax_percentage     Int
//   vat                   Int
//   amount_paid_and_tax_deducted    Float //Old dataType "float"
//   tax_rate_deducted     Int
//   withholding_status    Doc_Status   @default(WAIT_APPROVE) //Old dataType "enum('approve','cancel','wait_approve','draft')"
//   accountBoss           Int
//   money_paid_in         Int
//   numApprove            Int
//   note                  String
//   createdBy             Int
//   createdDtm            DateTime @default(now())
//   business_id           Int
// }

// model tbl_withholding_item {
//   withholding_item_id         String  @id @default(auto()) @map("_id") @db.ObjectId
//   department_type             Float
//   withholding_item_other      String
//   date_tax_paid               DateTime @default(now())
//   withholding_id              Int
// }

// enum Doc_Status {
//   APPROVE
//   CANCEL
//   WAIT_APPROVE
//   DRAFT
// }

// enum ODstatus {
//   UNPAID
//   PAID
//   WAIT_VERIFY
//   PREPARE_FOR_DELIVERY
//   SHIPPED
//   CANCEL_ORDER
// }

// enum CDP_status {
//   APPROVE
//   CANCEL
//   WAIT_APPROVE
//   DRAFT
//   CREATE_TAX_INVOICE
// }

// enum PdStatus {
//   USE
//   CANCEL
// }

// enum Userstatus {
//   ON
//   OFF
// }

// enum IsDeleted {
//   YES
//   NO
// }

// enum is_Person {
//   YES
//   NO
//   LEGAL
//   PERSON
// }

// enum is_Vat {
//   YES
//   NO
// }

enum VerifiedStatus {
  Verified
  UnVerified
}

enum UserStatus {
  Active
  InActice
}

enum RoleName {
  Developer
  Administrator
  User
  Customer
}

enum ProviderAccount {
  Google
  Facebook
  Email
}
